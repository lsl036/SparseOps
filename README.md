# Sparse Operators Lib
My playground for developing different high-performance Sparse operators. Now I'm writing SpGEMM.

# SubModule 1: Sparsity-aware SpMV (SSpMV)
**Sparsity-aware SpMV** is a library for SpMV implemented by different sparse matrix format.
It can adaptively select the optimal performance format and algorithm to compute SpMV operation.
Right now, the most of kernel code can deploy to different CPU platforms (have tested successfully on both Intel and ArmV8).
The parallelism of these SpMV algorithms are achieved by OpenMP, the SIMD optimizations rely on `#pragma omp simd` and Intel compiler's option (see *CMakeLists.txt*).

## Repository Structure


### SpOps
This library is designed for different platforms. It can auto-detect the hardware information and write the configurations into `./include/plat_config.h`. The code structure is:

`include`: Contains the head files for SpOps library. 

`src`: Contains different SpMV kernels implementations.

`utils`: Contains some auxiliary function routines including memory IO, sparse matrix reading and test helper.

`test`: Contains some test routines that can check the results' correctness and performance for different sparse matrix format.

`features`: Prepared for storing the matrix features extracted by `Get_features`.

## Compilation and Installation
Typically, SSpMV library is easy to install. Please follow the steps:
```
cd SparseOps
mkdir build && cd build
cmake ..
make
```
Then you will get some test routines of different SpMV algorithms. If some compiling errors occur, please see *CMakeLists.txt* for compiling details.

## Supported Matrix Format
- **COO** : The COO is also known as the transactional format. In this format, the matrix is represented as a set of triples , where x is an entry in the matrix and i and j denote its row and column indices, respectively.
- **CSR** : The most common format for CSRs is the [PKCS #10](https://en.wikipedia.org/wiki/Certificate_signing_request) specification; others include the more capable Certificate Request Message Format (CRMF) and the SPKAC (Signed Public Key and Challenge) format generated by some web browsers.
- **BSR** : The Block Sparse Row (BSR) format is very similar to the Compressed Sparse Row (CSR) format, which is mainly used in intel MKL solver. A non-zero block is the block that contains at least one non-zero element. Please click [here](http://z-s.xyz/2019/04/20/Block-Compressed-Sparse-Row-BSR-Matrix-Format/) for more details about this format.
- **CSR5** : An complicated version of CSR format to exploit SIMD acceleration on AVX-512. This format only support the Intel CPU. Please click [here](https://arxiv.org/abs/1503.05032) for the whole paper.
- **DIA** : Diagonal Storage (DIA) format. Please click [here](https://phys.libretexts.org/Bookshelves/Mathematical_Physics_and_Pedagogy/Computational_Physics_(Chong)/08%3A_Sparse_Matrices/8.02%3A_Sparse_Matrix_Formats) for a quick introduction.
- **ELL** : The traditional ELL format compresses the matrix data into a rectangular dense matrix, and adds zeros to force each column in the matrix to have the same number of elements. The matrix data is then stored column by column, followed by their column indices in the original sparse matrix.
- **S-ELL** : Sliced ELL format. Multiple rows are packed into a row block for the ELL storage. Please click [here](https://library.eecs.utk.edu/storage/files/ut-eecs-14-727.pdf) for more detailed implementation. **Parameters: chunk width C.**
- SELL-c- $\sigma$ : Sliced ELL format with $\sigma$ slice for reordering. **Parameters: chunk width C, slice width $\sigma$**.
- SELL-c-R : Here the $\sigma=R$, reorder the whole matrix rows without sliced tiles.

### Test Correctness of SpGEMM

- Row-wise SpGEMM kernels:

Finished make all stuffs:
``` 
python3 run_rowwise_spgemm.py --kernel=1 (1, 2 or 3 for different row-wise kernels)
```
Then the C matrix will be writteï¼Œthen you can run (the correct results should be stored in `script/`):
```
python3 ../script/compare_results_rowwise.py --kernel=1 (1, 2 or 3 corresponding above)
```

- Fixed-lengrh Cluster SpGEMM kernels:

1-hash kernel ; 2-array kernel. 
``` 
python3 run_fcluster_spgemm.py --kernel=1 (1, 2)

python3 ../script/compare_results_flength.py --kernel=1 (1, 2)
```

